<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Mar de Livros | Meu perfil</title>

    <script src="./js/sessao.js"></script>

    <link rel="stylesheet" href="css/style.css">

</head>

<body class="inter" style="padding: 2%;">
    <main>


        <!-- Aqui começa o header -->
        <div class="header">
            <img class="logo_header" src="./assets/imgs/mar-de-livros-com-fundo.png" alt="">
            <div class="botoes">
                <div>
                    <button class="button" onclick="categorias()">CATEGORIAS</button>
                    <div id="div_categorias" class="categorias" style="display: none;">
                        <span class="botoesCategoria">
                            <button class="buttonCategoria">Romance</button>
                            <button class="buttonCategoria">Literatura Brasileira</button>
                            <button class="buttonCategoria">Literatura Inlgesa</button>
                            <button class="buttonCategoria">Terror/Suspense</button>
                            <button class="buttonCategoria">Aventura/Ação</button>
                            <button class="buttonCategoria">Infantil</button>
                            <button class="buttonCategoria">Drama</button>
                            <button class="buttonCategoria">História</button>
                            <button class="buttonCategoria">Ficção Científica</button>
                            <button class="buttonCategoria">Fantasia</button>
                        </span>
                    </div>
                </div>
                <button class="button" onclick="anne()">SESSÃO ANNE</button>
                <button class="button" onclick="index()">HOME</button>

            </div>
        </div>
        <!-- Aqui acaba o header -->

        <!-- Aqui começa a edição do perfil -->
        <div class="edicaoPerfil">
            <div class="container3">
                <img class="img_sobreMim" src="./assets/imgs/minha-foto-perfil - Editado.jpg" alt="">
                <p><b><i>Maria Rosa </i></b></p>
            </div>
            <div class="descricao">
                <h2>Descrição</h2>
                <p>Meu nome é Maria Rosa, tenho 22 anos, meu signo é de áries, caso isso seja importante para
                    alguém. E eu amo ler! Sério, amo mesmo, eu leio qualquer coisa, eu preciso da leitura, porque
                    ver letras juntas formando palavras e frases é como ter ar para respirar. Mas claro, nesses anos
                    como leitora eu descobri alguns nichos dos quais eu mais gosto, eu adoro livros de romance, e se
                    envolve filosofia tem mais chance de me interessar e eu amo livros que fazem ligações e conexões
                    de conhecimento, como por exemplo o Tao da Física de Fritjof Capra, um livro que mostra uma
                    conexão entre o estudo da física e as religiões orientais. Aqui neste site pretendo compartilhar
                    meus pontos de vista!
                </p>
            </div>
        </div>
        </div>
        <div id="div_mensagem"></div>

        <!-- Aqui termina a descricao-->

        <!-- Aqui começa o gráfico-->
        <div class="graficoPai">
            <div class="grafico">
                <div>
                    <canvas class="myChart" id="myChart"></canvas>
                </div>
            </div>

            <!-- KPI's -->

            <div class="kpis">
                <div class="labels">
                    <div class="labelPai">
                        <div class="label1"></div>Acima do Esperado
                    </div>
                    <div class="labelPai">
                        <div class="label2"></div>Dentro do Esperado
                    </div>
                    <div class="labelPai">
                        <div class="label3"></div>Abaixo do Esperado
                    </div>
                </div>

                <div id="kpiContagem">
                </div>

                <div id="kpiMedia">
                </div>
            </div>
        </div>

    </main>
</body>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>

    window.onload = function () {
        obterDados(),
            receberContagem(),
            receberMediaComentarios()
    }

    // Função para Bios

    // listaBio = {
    //     livro: [],
    //     genero: [],
    //     descricao: []
    // };

    // function editar() {

    //     var livro = input_livro.value.trim();
    //     var genero = input_genero.value.trim();
    //     var descricao = textarea_descricao.value.trim();

    //     if (livro != '' || genero != '' || descricao != '') {

    //         listaBio.livro.push(livro);
    //         listaBio.genero.push(genero);
    //         listaBio.descricao.push(descricao);

    //         console.log('Bios cadastrada com sucesso!');
    //     } else {
    //         console.log('Erro')
    //     }

    //     for (var i = 0; i < listaBio.livro.length; i++) {

    //         div_LivroPreferido.innerHTML = `<b> Livro preferido: </b> ${listaBio.livro[listaBio.livro.length - 1]}`;
    //         div_generoLeitura.innerHTML = `<b> Gênero de leitura preferido: </b> ${listaBio.genero[listaBio.descricao.length - 1]}`;
    //         div_biosDescricao.innerHTML = `<b> Descrição: </b> ${listaBio.descricao[listaBio.descricao.length - 1]}`;

    //     }

    // }


    // Ir para outras páginas

    var div_block = false;

    function categorias() {

        if (div_block == true) {
            document.getElementById('div_categorias').style.display = "none";

            div_block = false;

        } else {
            document.getElementById('div_categorias').style.display = "block";

            div_block = true;
        }

    }

    function anne() {
        window.location.href = 'sessaoAnne.html';

    }

    function index() {
        window.location.href = 'index.html';
    }

    // Funções para gráfico

    function plotarGrafico(dados) {
        var ctx = document.getElementById('myChart');

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: dados.label,
                datasets: [{
                    label: 'Comentários por Dia',
                    data: dados.data,
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    function prepararDados(resposta) {
        var dadosTratados = {
            label: [],
            data: []
        }

        for (var i = 0; i < resposta.length; i++) {
            dadosTratados.label.push(resposta[i].dia);
            dadosTratados.data.push(resposta[i].qtComentario);
        }

        return dadosTratados;
    }

    function obterDados() {
        fetch(`/comentarios/por-dia`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                    var dados = prepararDados(resposta);
                    plotarGrafico(dados);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    // Funções para KPIs
    function receberContagem() {
        fetch(`/comentarios/countComentarios`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                    countComentarios(resposta[0].qtdComentarios)

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function countComentarios(dadosContagem) {
        console.log(dadosContagem);
        if (dadosContagem < 5) {
            kpiContagem.innerHTML = `<div class="kpi_corVermelha" id="kpi2">
                                         <h1 id="h1_kpi2">${dadosContagem}</h1>
                                         <div>Quantidade de comentários por dia</div>
                                    </div>`
        } else if (dadosContagem < 10) {
            kpiContagem.innerHTML = `<div class="kpi_corAmarela" id="kpi2">
                                        <h1 id="h1_kpi2">${dadosContagem}</h1>
                                        <div>Quantidade de comentários por dia</div>
                                    </div>`
        } else if (dadosContagem > 10) {
            kpiContagem.innerHTML = `<div class="kpi_corVerde" id="kpi2">
                                        <h1 id="h1_kpi2">${dadosContagem}</h1>
                                        <div>Quantidade de comentários por dia</div>
                                    </div>`
        }

    }

    function receberMediaComentarios() {
        fetch(`/comentarios/mediaComentarios`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                    mediaComentarios(resposta[0].mediaDeComentarios)

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function mediaComentarios(dadosMediaComentarios) {
        if (dadosMediaComentarios < 5) {
            kpiMedia.innerHTML = `<div class="kpi_corVermelha" id = "kpi2" >
                                                <h1 id="h1_kpi2">${dadosMediaComentarios}</h1>
                                                <div>Média de comentários por dia</div>
                                            </div > `
        } else if (dadosMediaComentarios < 10) {
            kpiMedia.innerHTML = `<div class="kpi_corAmarela" id = "kpi2" >
                                                <h1 id="h1_kpi2">${dadosMediaComentarios}</h1>
                                                <div>Média de comentários por dia</div>
                                            </div > `
        } else if (dadosMediaComentarios > 10) {
            kpiMedia.innerHTML = `<div class="kpi_corVerde" id = "kpi2" >
                                                <h1 id="h1_kpi2">${dadosMediaComentarios}</h1>
                                                <div>Média de comentários por dia</div>
                                            </div > `
        }

    }

</script>