<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Mar de Livros | Home</title>

    <script src="./js/sessao.js"></script>

    <link rel="stylesheet" href="css/style.css">

</head>

<body class="inter" onload="obterDados()">
    <!-- Aqui começa o header -->
    <div class="header">
        <img class="logo_header" src="./assets/imgs/mar-de-livros-com-fundo.png" alt="">
        <div class="botoes">
            <div>
                <button class="button" onclick="categorias()">CATEGORIAS</button>
                <div id="div_categorias" class="categorias" style="display: none;">
                    <span class="botoesCategoria">
                        <button class="buttonCategoria">Romance</button>
                        <button class="buttonCategoria">Literatura Brasileira</button>
                        <button class="buttonCategoria">Literatura Inlgesa</button>
                        <button class="buttonCategoria">Terror/Suspense</button>
                        <button class="buttonCategoria">Aventura/Ação</button>
                        <button class="buttonCategoria">Infantil</button>
                        <button class="buttonCategoria">Drama</button>
                        <button class="buttonCategoria">História</button>
                        <button class="buttonCategoria">Ficção Científica</button>
                        <button class="buttonCategoria">Fantasia</button>
                    </span>
                </div>
            </div>
            <button class="button" onclick="sobreMim()">SOBRE MIM</button>
            <button class="button" onclick="anne()">SESSÃO ANNE</button>
            <button class="button" onclick="login()">LOGIN</button>
            <button class="button" onclick="cadastro()">CADASTRE-SE</button>

        </div>

    </div>
    <!-- Aqui acaba o header -->

    <!-- Aqui começa o primeiro carrossel -->
    <div class="container">
        <div class="quadrado">
            <img src="./assets/imgs/mockups-oficiais/madona-de-cedro-cortado.png" alt="">
            <p>A Madona de cedro - Antonio Calado</p>
        </div>

        <div class="quadrado">
            <img src="./assets/imgs/mockups-oficiais/o-cortico-cortado.png" alt="">
            <p>O cortiço - Aluísio de Azevedo</p>
        </div>

        <div class="quadrado">
            <img src="./assets/imgs/mockups-oficiais/o-estrangeiro-cortado.png" alt="">
            <p>O estrangeiro - Albert Camus</p>
        </div>

        <div class="quadrado">
            <img src="./assets/imgs/mockups-oficiais/o-tao-da-fisica-oficial-cortado.png" alt="">
            <p>O tao da física - Fritjof Capra</p>
        </div>
    </div>
    <!-- Aqui termina o primeiro carrossel -->

    <!-- Aqui começa o livro preferido -->

    <div class="livroPreferido_Pai">
        <p class="frank_ruhl_libre">Meu livro preferido do momento:</p>
        <div class="livroPreridoConteudo">
            <div class="container2">
                <div class="imagemPreferido">
                    <img class="img_preferido" src="./assets/imgs/mockups-oficiais/o-falecido-mattia-pascal.png" alt="">
                    <p id="tituloPreferido">O Falecido Mattia Pascal - Luigi Pirandello</p>
                </div>
            </div>
            <div class="paragrafo1">
                <p id="textoExplicativo1"> A história do falecido Mattia Pascal é uma das melhores que já li. O
                    protagonista é engraçado sem precisar ficar fazendo piadas o tempo todo. O autor consegue adicionar
                    um tom de comédia a história muito bom e é engraçado por ser real, é uma história na qual é fácil se
                    identificar, onde você torce e entende o protagonista, fica curioso para ver aonde ele vai chegar.
                    <br> É divertido que mesmo o autor dando uma chance de mudança de vida muito fácil para o
                    personagem, ainda sim você consegue se convencer e se entreter com a história.
                    <br> É um livro cheio de filosofia e questões que instigam o pensamento sobre o significado da vida,
                    viver emm sociedade, a mentira, e nossa pŕopria identidade e como isso influencia nossas escolhas,
                    nossas vidas.
                </p>
            </div>
        </div>
    </div>
    <!-- Aqui termina o livro preferido -->

    <!-- Aqui começa os comentarios-->
    <div class="comentariosPai">
        <div class="comentarios" id="div_comentario">
            <h4>Comentários</h4>

            <div class="fazerComentario">
                <input id="form_postagem" placeholder="Deixe um comentário..." name="descricao"></input>
                <button class="button_comentar" onclick="comentar()">COMENTAR</button>
            </div>
        </div>
    </div>

    <!-- Aqui termina os comentarios-->

    <!-- Aqui começa a sessão Sobre mim-->
    <div class="sobreMimPai">

        <p class="frank_ruhl_libre" class="tituloPrincipal">Sobre mim:</p>

        <div class="sobreMimConteudo">

            <div class="sobreMim" id="sobreMim">
                <div class="paragrafo2">
                    <p id="textoExplicativo2"> <b>Quem sou eu?</b> <br> <br>
                        Meu nome é Maria Rosa, tenho 22 anos, meu signo é de áries, caso isso seja importante para
                        alguém. E eu amo ler! Sério, amo mesmo, eu leio qualquer coisa, eu preciso da leitura, porque
                        ver letras juntas formando palavras e frases é como ter ar para respirar. Mas claro, nesses anos
                        como leitora eu descobri alguns nichos dos quais eu mais gosto, eu adoro livros de romance, e se
                        envolve filosofia tem mais chance de me interessar e eu amo livros que fazem ligações e conexões
                        de conhecimento, como por exemplo o Tao da Física de Fritjof Capra, um livro que mostra uma
                        conexão entre o estudo da física e as religiões orientais. Aqui neste site pretendo compartilhar
                        meus pontos de vista! <br>
                    </p>
                </div>
                <div class="container3">
                    <img class="img_sobreMim" src="./assets/imgs/minha-foto-perfil - Editado.jpg" alt="">
                    <p><b><i>Maria Rosa</i></b></p>
                </div>
            </div>
        </div>
    </div>

    <div class="banner">
        <img src="./assets/imgs/artes-de-monet/monet-jardim-em-giverny-banner.png" alt="">
    </div>
    <!-- Aqui termina a sessão Sobre mim-->
    <!-- Aqui começa a sessão Questionário-->
    <div class="questionario">
        <div class="questionarioConteudo">
            <p class="tituloQuestionario">
                Qual seu gênero de livro preferido?
            </p>
            <div id="opcoes" class="opcoes"> <!--Romance / Terror / Fantasia / Ação -->
                <span>
                    <input type="checkbox" value="romance" id="check_primeiraOpcao" name="generoLivro" />
                    <label for="check_primeiraOpcao" class="option" id="labelOpcaoUm">Romance</label>
                </span>
                <span>
                    <input type="checkbox" value="terror" id="check_segundaOpcao" name="generoLivro" />
                    <label for="check_segundaOpcao" class="option" id="labelOpcaoDois">Terror</label>
                </span>
                <span>
                    <input type="checkbox" value="fantasia" id="check_terceiraOpcao" name="generoLivro" />
                    <label for="check_terceiraOpcao" class="option" id="labelOpcaoTres">Fantasia</label>
                </span>
                <span>
                    <input type="checkbox" value="acao" id="check_quartaOpcao" name="generoLivro" />
                    <label for="check_quartaOpcao" class="option" id="labelOpcaoQuatro">Ação</label>
                </span>
                <span>
                    <input type="checkbox" value="ficcao_cientifica" id="check_quintaOpcao" name="generoLivro" />
                    <label for="check_quintaOpcao" class="option" id="labelOpcaoQuinta">Ficcção Científica</label>
                </span>
            </div>
            <button class="button_comentar" id="button_votar" onclick="votar()">VOTAR</button>

            <button class="button_comentar" id="button_resultado" onclick="verResultado()"><B>VER RESULTADO</B></button>

            <div id="respostaQuestionario"></div>
        </div>
    </div>

    <!-- Aqui começa a sessão playlist-->
    <div class="playlist">
        <p class="frank_ruhl_libre" class="tituloPrincipal">Nossa playlist:</p>
        <div><iframe data-testid="embed-iframe" style="border-radius:12px"
                src="https://open.spotify.com/embed/playlist/3Rc0WOCujl7pMvsp8kq8n3?utm_source=generator" width="40%"
                height="352" frameBorder="0" allowfullscreen=""
                allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                loading="lazy"></iframe></div>

    </div>
    <!-- Aqui termina a sessão playlist-->

    <!-- Aqui começa o footer-->
    <div class="footer">
        <div class="conteudoFooter">
            <img src="./assets/imgs/mar-de-livros-com-fundo.png" alt="">


            <div class="direitosAutorais">
                <p>2025 © Todos os Direitos Reservados - Mar de Livros </p>
            </div>

            <div class="redesSociaisPai">
                <div class="redesSociais">
                    <p><img width="8%" src="./assets/imgs/icones/Design sem nome/2.png" alt="">
                        @mar_de_livros</p>
                    <p><img width="8%" src="./assets/imgs/icones/Design sem nome/1.png" alt="">
                        Mar de Livros</p>
                </div>
            </div>
        </div>
    </div>
    <!-- Aqui termina o footer-->

</body>

</html>

<script>

    var div_block = false;
    
    function categorias() {

        if (div_block == true) {
            document.getElementById('div_categorias').style.display = "none";

            div_block = false;

        } else {
            document.getElementById('div_categorias').style.display = "block";

            div_block = true;
        }

    }

    function sobreMim() {
        window.location.href = '#sobreMim';

    }

    function anne() {
        window.location.href = 'sessaoAnne.html';

    }

    function login() {
        window.location.href = 'login.html';
    }

    function cadastro() {
        window.location.href = 'cadastro.html';
    }

    // Funções para armazenar comentários

    window.onload = function () {
        obterDados();
    }

    function obterDados() {
        fetch(`/comentariosIndex/listarComentariosIndex`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    ultimoComentario(resposta);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function ultimoComentario(resposta) {
        for (var i = 0; i < resposta.length; i++) {
            div_comentario.innerHTML += `<div class="comentario">${resposta[i].NomeUser}: ${resposta[i].Comentario} </div>`
        }
    }

    // insert do comentário no index
    function comentar() {
        var postagem = form_postagem.value.trim(); // var idUsuario = sessionStorage.ID_USUARIO;


        var corpo = {
            comentario: postagem,
            idUsuario: sessionStorage.ID_USUARIO
        }

        fetch(`/comentariosIndex/cadastrarComentario`, {
            method: "post",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(corpo)
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                window.alert("Post realizado com sucesso!");
                limparFormulario();
                finalizarAguardar();
            } else if (resposta.status == 404) {
                window.alert("Deu 404!");
            } else {
                throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            finalizarAguardar();
        });

        return false;

    }


    // Funções questionário
    var listaEscolha = [];

    var contTentativas = 0;
    var mediaDeTentativas = 0;

    var livroEscolhidoRecomencao = '';

    function votar() {
        var valoresCheckBox = document.getElementsByName('generoLivro');

        for (var i = 0; i < valoresCheckBox.length; i++) {
            if (valoresCheckBox[i].checked) {
                listaEscolha.push(valoresCheckBox[i].value);

            }
        }

        console.log(listaEscolha);

        contTentativas++

        livroEscolhidoRecomencao = '';
    }

    // Lista de recomendações
    var livrosRomance = ['Senhora, de José de Alencar', 'O cortiço, de Aluísio de Azevedo', 'A boa terra, de Pearls S. Buck', 'Anne de Green Gables, de Lucy Maud Montgomery'];

    var livrosTerror = ['Christine, de Stephen King', 'Joyland, de Stephen King', 'Dŕacula, de Bram Stoker', 'O orfanato da Srta Peregrine para crianças peculiares, de Ransom Riggs', 'Histórias de Mistério, de Lygia Fagundes Telles', 'A menina do fim da rua, de Laird Koenig'];

    var livrosFantasia = ['Magisterium, desafio de ferro, Cassandra Clare e Holly Black', 'Maze Runner, correr ou morrer, de James Dashner', 'A Bússola de Ouro, de Philip Pullman', 'A faca sutil, de Philip Pullman', 'A luneta âmbar, de Philip Pullman', 'Memórias de um Sobrevivente, de Doris Lessing'];

    var livrosAcao = ['Quebrando a banca, Ben Mezrich', 'Depois da escuridão, de Sidney Sheldon', 'Vinte mil léguas submarinas, de Júlio Verne', '1984, de George Orwell'];

    var livrosFiccao = ['O guia do mochileiro das galáxias, Doouglas Adams', 'Diário de bordo do astronauta Roger, de Roger Jones', 'A faca sutil, de Philip Pullman'];

    // Tamanhos das listas de recomendações

    var tamanhoLivrosRomance = livrosRomance.length;
    var tamanhoLivrosTerror = livrosTerror.length;
    var tamanhoLivrosFantasia = livrosFantasia.length;
    var tamanhoLivrosAcao = livrosAcao.length;
    var tamanhoLivrosFiccao = livrosFiccao.length;

    // Cálculo para média de tentativas
    mediaDeTentativas = contTentativas / listaEscolha.length;

    function verResultado() {

        var escolhaRomance = ' livros de romance';
        var escolhaTerror = ' livros de terror';
        var escolhaFantasia = ' livros de fantasia';
        var escolhaAcao = ' livros de ação';
        var escolhaFiccao = ' livros de ficção cientifica';
        var mensagem = '';

        respostaQuestionario.innerHTML = `Você gosta de `;

        var tamanhoLista = listaEscolha.length;

        var qtVezesApareceR = 0;
        var qtVezesApareceT = 0;
        var qtVezesApareceF = 0;
        var qtVezesApareceA = 0;
        var qtVezesApareceFC = 0;

        for (var k = 0; k < tamanhoLista; k++) {
            if (listaEscolha.includes('romance')) {
                qtVezesApareceR += 1;
            }

            if (listaEscolha.includes('terror')) {
                qtVezesApareceT += 1;
            }

            if (listaEscolha.includes('fantasia')) {
                qtVezesApareceF += 1;
            }

            if (listaEscolha.includes('acao')) {
                qtVezesApareceA += 1;
            }

            if (listaEscolha.includes('ficcao_cientifica')) {
                qtVezesApareceFC += 1;
            }
        }



        for (var i = 0; i < tamanhoLista; i++) {

            // var ultimoValorLista = listaEscolhasDoUser[1].length-1

            // Opções: Romance / Terror / Fantasia / Ação / Ficção Científica

            if (listaEscolha.includes('romance')) {
                mensagem += `${escolhaRomance},`

                // Recomenção de um livro
                var numAleatorio0 = Math.floor(Math.random() * tamanhoLivrosRomance);
                livroEscolhidoRecomencao += `<br> - ${livrosRomance[numAleatorio0]} - <i>Romance</i> <br>  <br>`;

                tamanhoLista -= qtVezesApareceR;
            }

            if (listaEscolha.includes('terror')) {
                mensagem += `${escolhaTerror},`

                // Recomenção de um livro
                var numAleatorio1 = Math.floor(Math.random() * tamanhoLivrosTerror);
                livroEscolhidoRecomencao += `<br> - ${livrosTerror[numAleatorio1]} - <i>Terror</i> <br>  <br>`;

                tamanhoLista -= qtVezesApareceT;
            }

            if (listaEscolha.includes('fantasia')) {
                mensagem += `${escolhaFantasia},`

                // Recomenção de um livro
                var numAleatorio2 = Math.floor(Math.random() * tamanhoLivrosFantasia);
                livroEscolhidoRecomencao += `<br> - ${livrosFantasia[numAleatorio2]} - <i>Fantasia</i> <br>  <br>`;

                tamanhoLista -= qtVezesApareceF;
            }

            if (listaEscolha.includes('acao')) {
                mensagem += `${escolhaAcao},`

                // Recomenção de um livro
                var numAleatorio3 = Math.floor(Math.random() * tamanhoLivrosAcao);
                livroEscolhidoRecomencao += `<br> - ${livrosAcao[numAleatorio3]} - <i>Ação</i> <br>  <br>`;

                tamanhoLista -= qtVezesApareceA;
            }

            if (listaEscolha.includes('ficcao_cientifica')) {
                mensagem += `${escolhaFiccao},`

                // Recomenção de um livro
                var numAleatorio4 = Math.floor(Math.random() * tamanhoLivrosFiccao);
                livroEscolhidoRecomencao += `<br> - ${livrosFiccao[numAleatorio4]} - <i>Ficção científica</i> <br>  <br>`;

                tamanhoLista -= qtVezesApareceFC;
            }
        }

        respostaQuestionario.innerHTML += `${mensagem}!`;

        respostaQuestionario.innerHTML += `<br> <br>Você votou ${contTentativas} vezes <br> <br>
                                            A sua média de tentativas é ${mediaDeTentativas} <br> <br>
                                           <b> Recomendações de livros:</b> ${livroEscolhidoRecomencao}`;

        listaEscolha = [];

    }

</script>